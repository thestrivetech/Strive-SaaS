# Session 1 Todo List - Tool & Dashboard Marketplace
## Database Foundation & Marketplace Schema

### Phase 1: Schema Analysis & Planning
- [x] Read session plan (session-1.plan.md)
- [x] Read integration plan (tool-marketplace-integration-plan.md)
- [x] Read existing Prisma schema (shared/prisma/schema.prisma)
- [x] Understand existing enums and models
- [ ] Identify conflicts or naming issues with existing schema

### Phase 2: Add Enums to Prisma Schema
- [ ] Add ToolCategory enum (FOUNDATION, GROWTH, ELITE, CUSTOM, ADVANCED, INTEGRATION)
- [ ] Add ToolTier enum (T1, T2, T3)
- [ ] Add BundleType enum (STARTER_PACK, GROWTH_PACK, ELITE_PACK, CUSTOM_PACK)
- [ ] Add PurchaseStatus enum (ACTIVE, CANCELLED, REFUNDED, EXPIRED)
- [ ] Verify enum placement in schema (after existing enums)

### Phase 3: Add Marketplace Models to Prisma Schema
- [ ] Add marketplace_tools model with all fields, indexes, and relations
- [ ] Add tool_purchases model with organizationId, indexes, and unique constraint
- [ ] Add tool_bundles model with all fields and indexes
- [ ] Add bundle_tools junction table model
- [ ] Add bundle_purchases model with organizationId and indexes
- [ ] Add tool_reviews model with organizationId and unique constraint
- [ ] Add shopping_carts model with JSONB fields and organizationId

### Phase 4: Update Existing Models for Relations
- [ ] Update users model - add tool_purchases, bundle_purchases, tool_reviews, shopping_cart relations
- [ ] Update organizations model - add tool_purchases, bundle_purchases, tool_reviews, shopping_carts relations
- [ ] Verify relation field names match new models

### Phase 5: Create Database Migrations (Supabase MCP)
Note: Session plan specifies using Supabase MCP tools, but I don't see them available. Will need to proceed with Prisma CLI approach.

- [ ] Generate Prisma migration: npx prisma migrate dev --name add_marketplace_schema --schema=../shared/prisma/schema.prisma
- [ ] Verify migration files created
- [ ] Review migration SQL for correctness
- [ ] Apply migration to database
- [ ] Generate Prisma client: npx prisma generate --schema=../shared/prisma/schema.prisma

### Phase 6: Add RLS Policies (Database Level)
Note: RLS policies should be created via SQL migration or Supabase dashboard

- [ ] Create RLS migration file for tool_purchases table
- [ ] Create RLS migration file for bundle_purchases table
- [ ] Create RLS migration file for tool_reviews table
- [ ] Create RLS migration file for shopping_carts table
- [ ] Enable RLS on all four tables
- [ ] Create tenant isolation policies (organization_id based)
- [ ] Add composite indexes for performance (org_id + status)

### Phase 7: Verification & Testing
- [ ] Run TypeScript check: npx tsc --noEmit
- [ ] Verify all tables exist in database
- [ ] Verify all enums created correctly
- [ ] Verify indexes created
- [ ] Verify foreign key constraints
- [ ] Test RLS policies work correctly
- [ ] Check Prisma client types generated

### Phase 8: Documentation
- [ ] Create session-1-summary.md with:
  - All files modified (shared/prisma/schema.prisma)
  - Migration files created
  - Verification command outputs
  - RLS policies applied
  - TypeScript check results
  - Next steps for Session 2

### Files to Modify
- shared/prisma/schema.prisma (read first, then edit)

### Files to Create
- Migration files (auto-generated by Prisma)
- RLS policy migration (if needed)
- session-1-summary.md

### Success Criteria Checklist
- [ ] All 7 marketplace models added to schema
- [ ] All 4 enums defined correctly
- [ ] All relationships established (users, organizations)
- [ ] organizationId field on multi-tenant tables (tool_purchases, bundle_purchases, tool_reviews, shopping_carts)
- [ ] Proper indexes created (category, tier, status, organization_id)
- [ ] Migrations run successfully
- [ ] Prisma client generates without errors
- [ ] RLS policies enabled on multi-tenant tables
- [ ] TypeScript types available for all models
- [ ] Zero TypeScript errors
- [ ] Session summary created
