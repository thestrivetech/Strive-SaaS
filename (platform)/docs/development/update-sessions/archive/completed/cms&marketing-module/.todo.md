# ContentPilot CMS & Marketing - Session 1 Todo List

## Session 1: Database Schema & Foundation

### Phase 1: Schema Analysis & Planning
- [ ] pending: Read existing Prisma schema completely to understand current structure
- [ ] pending: Identify existing enums that can be reused vs new ones needed
- [ ] pending: Check for conflicts with existing `content` table (needs renaming or removal)
- [ ] pending: Verify User and Organization models for relation additions

### Phase 2: Update Prisma Schema (shared/prisma/schema.prisma)
- [ ] pending: Handle existing `content` table conflict (rename to old_content or remove if unused)
- [ ] pending: Add ContentItem model with all fields, indexes, and relations
- [ ] pending: Add ContentCategory model with hierarchy support
- [ ] pending: Add ContentTag model with usage tracking
- [ ] pending: Add MediaAsset model with file metadata
- [ ] pending: Add MediaFolder model with hierarchy support
- [ ] pending: Add Campaign model with performance metrics
- [ ] pending: Add CampaignContent junction model
- [ ] pending: Add EmailCampaign model with email-specific fields
- [ ] pending: Add SocialMediaPost model with multi-platform support
- [ ] pending: Add ContentRevision model for version history
- [ ] pending: Add ContentComment model with hierarchy support
- [ ] pending: Add/Update ContentType enum (check existing, extend if needed)
- [ ] pending: Add/Update ContentStatus enum (check existing, extend if needed)
- [ ] pending: Add CampaignType enum
- [ ] pending: Add CampaignStatus enum
- [ ] pending: Add EmailStatus enum
- [ ] pending: Add PostStatus enum
- [ ] pending: Add CommentStatus enum
- [ ] pending: Add SocialPlatform enum
- [ ] pending: Update User model - add ContentPilot relations
- [ ] pending: Update Organization model - add ContentPilot relations

### Phase 3: Generate Prisma Client
- [ ] pending: Run npx prisma format to validate schema syntax
- [ ] pending: Run npx prisma validate to check for errors
- [ ] pending: Run npx prisma generate to create TypeScript types

### Phase 4: Create Database Migration (via Prisma)
- [ ] pending: Run npx prisma migrate dev --name add_contentpilot_cms_tables
- [ ] pending: Verify migration files created successfully
- [ ] pending: Check migration for proper foreign keys and cascades

### Phase 5: Apply RLS Policies (via Supabase or direct SQL)
- [ ] pending: Create SQL script for enabling RLS on all ContentPilot tables
- [ ] pending: Create tenant isolation policies for content_items
- [ ] pending: Create tenant isolation policies for content_categories
- [ ] pending: Create tenant isolation policies for content_tags
- [ ] pending: Create tenant isolation policies for media_assets
- [ ] pending: Create tenant isolation policies for media_folders
- [ ] pending: Create tenant isolation policies for campaigns
- [ ] pending: Create tenant isolation policies for campaign_content
- [ ] pending: Create tenant isolation policies for email_campaigns
- [ ] pending: Create tenant isolation policies for social_media_posts
- [ ] pending: Create tenant isolation policies for content_revisions
- [ ] pending: Create tenant isolation policies for content_comments
- [ ] pending: Apply RLS SQL script to database

### Phase 6: Create Performance Indexes
- [ ] pending: Create composite index for content search (org + status + published)
- [ ] pending: Create full-text search index on content (title + content body)
- [ ] pending: Create composite index for media queries (org + folder + uploaded)
- [ ] pending: Create composite index for campaigns (org + status + dates)
- [ ] pending: Apply performance indexes to database

### Phase 7: Verification & Testing
- [ ] pending: Run npx prisma db pull to verify schema matches database
- [ ] pending: Test multi-tenancy isolation with sample queries
- [ ] pending: Verify RLS policies are active on all tables
- [ ] pending: Check all indexes created successfully
- [ ] pending: Verify foreign key constraints working
- [ ] pending: Test cascade deletes (organization deletion)
- [ ] pending: Confirm Prisma client generates correct types

### Phase 8: Documentation & Summary
- [ ] pending: Document schema changes in session summary
- [ ] pending: List all 11 tables created
- [ ] pending: Document all enums added/updated
- [ ] pending: Create session1-summary.md with verification outputs
- [ ] pending: Include TypeScript check output: npx tsc --noEmit
- [ ] pending: Include database table count verification
- [ ] pending: Update progress percentage for overall ContentPilot integration

## Verification Commands (Required in Summary)
```bash
# TypeScript validation
npx tsc --noEmit

# Prisma validation
npx prisma validate --schema=../shared/prisma/schema.prisma

# Database verification (list tables)
# Use Supabase MCP or psql to list tables matching content_*, media_*, *campaign*, *comment*

# RLS verification
# Query pg_policies to confirm policies exist for all ContentPilot tables
```

## Blocking Criteria
- DO NOT report session complete unless:
  - All 11 ContentPilot tables exist in database
  - All enums defined (8 new/updated enums)
  - RLS enabled on ALL ContentPilot tables
  - Performance indexes created
  - Prisma client generates without errors
  - TypeScript check passes (0 errors)
  - session1-summary.md file created with proof

## Notes
- Existing `content` table conflicts with new ContentItem model
- Need to handle this carefully (rename or remove)
- Check ContentType and ContentStatus enums - may already exist
- All tables MUST have organizationId for multi-tenancy
- Cascade deletes critical for organization cleanup
