generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model activities {
  id               String        @id
  type             ActivityType
  title            String        @db.VarChar(255)
  description      String?
  outcome          String?       @db.VarChar(500)
  duration_minutes Int?
  lead_id          String?
  contact_id       String?
  deal_id          String?
  listing_id       String?
  organization_id  String
  created_by_id    String
  created_at       DateTime?     @default(now()) @db.Timestamp(6)
  updated_at       DateTime?     @default(now()) @db.Timestamp(6)
  completed_at     DateTime?     @db.Timestamp(6)
  contacts         contacts?     @relation(fields: [contact_id], references: [id], onUpdate: NoAction)
  users            users         @relation(fields: [created_by_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  deals            deals?        @relation(fields: [deal_id], references: [id], onUpdate: NoAction)
  leads            leads?        @relation(fields: [lead_id], references: [id], onUpdate: NoAction)
  listings         listings?     @relation(fields: [listing_id], references: [id], onUpdate: NoAction)
  organizations    organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([contact_id], map: "idx_activities_contact_id")
  @@index([created_at], map: "idx_activities_created_at")
  @@index([created_by_id], map: "idx_activities_created_by_id")
  @@index([deal_id], map: "idx_activities_deal_id")
  @@index([lead_id], map: "idx_activities_lead_id")
  @@index([organization_id, created_at(sort: Desc)], map: "idx_activities_org_created")
  @@index([organization_id, type], map: "idx_activities_org_type")
  @@index([organization_id], map: "idx_activities_organization_id")
  @@index([type], map: "idx_activities_type")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model activity_logs {
  id              String        @id
  organization_id String
  user_id         String?
  action          String
  resource_type   String
  resource_id     String?
  old_data        Json?
  new_data        Json?
  ip_address      String?
  user_agent      String?
  created_at      DateTime      @default(now())
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users           users?        @relation(fields: [user_id], references: [id])

  @@index([organization_id, created_at])
  @@index([user_id])
  @@index([organization_id, action, created_at(sort: Desc)], map: "idx_activity_logs_org_action_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model admin_action_logs {
  id          String      @id
  action      AdminAction
  description String
  target_type String
  target_id   String
  metadata    Json?
  ip_address  String?
  user_agent  String?
  success     Boolean     @default(true)
  error       String?
  created_at  DateTime    @default(now()) @db.Timestamp(6)
  admin_id    String
  users       users       @relation(fields: [admin_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([action])
  @@index([admin_id])
  @@index([created_at])
  @@index([target_type, target_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ai_conversations {
  id                String        @id
  user_id           String
  organization_id   String
  title             String?
  context_type      AIContextType @default(GENERAL)
  context_id        String?
  ai_model          AIModel       @default(OPENAI_GPT4)
  conversation_data Json
  usage_tokens      Int           @default(0)
  is_archived       Boolean       @default(false)
  created_at        DateTime      @default(now())
  updated_at        DateTime
  organizations     organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users             users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([organization_id])
  @@index([user_id])
  @@index([organization_id, created_at(sort: Desc)], map: "idx_ai_conversations_org_created")
  @@index([user_id, created_at(sort: Desc)], map: "idx_ai_conversations_user_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ai_tools {
  id            String           @id
  name          String
  description   String?
  toolType      ToolType
  required_tier SubscriptionTier
  configuration Json?
  is_active     Boolean          @default(true)
  created_at    DateTime         @default(now())
  updated_at    DateTime
}

model analytics_events {
  id            String   @id
  source        String   @default("saas")
  session_id    String
  user_id       String?
  event_type    String
  event_name    String
  element_id    String?
  element_class String?
  element_text  String?
  url           String
  path          String
  x_position    Int?
  y_position    Int?
  scroll_depth  Int?
  properties    Json?
  timestamp     DateTime @default(now())

  @@index([event_type])
  @@index([session_id])
  @@index([source])
  @@index([timestamp])
}

model analytics_goals {
  id               String             @id
  name             String
  description      String?
  type             String
  conditions       Json
  value            Float?
  is_active        Boolean            @default(true)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  goal_conversions goal_conversions[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model appointments {
  id              String            @id
  organization_id String
  customer_id     String?
  assigned_to     String
  title           String
  description     String?
  start_time      DateTime
  end_time        DateTime
  status          AppointmentStatus @default(SCHEDULED)
  location        String?
  meeting_url     String?
  reminders_sent  Json?
  created_at      DateTime          @default(now())
  updated_at      DateTime
  lead_id         String?
  deal_id         String?
  listing_id      String?
  type            AppointmentType?  @default(OTHER)
  users           users             @relation(fields: [assigned_to], references: [id])
  customers       customers?        @relation(fields: [customer_id], references: [id])
  deals           deals?            @relation(fields: [deal_id], references: [id], onUpdate: NoAction)
  leads           leads?            @relation(fields: [lead_id], references: [id], onUpdate: NoAction)
  listings        listings?         @relation(fields: [listing_id], references: [id], onUpdate: NoAction)
  organizations   organizations     @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@index([organization_id])
  @@index([start_time])
  @@index([assigned_to, start_time(sort: Desc)], map: "idx_appointments_assigned")
  @@index([assigned_to, start_time], map: "idx_appointments_assigned_start")
  @@index([deal_id], map: "idx_appointments_deal_id")
  @@index([lead_id], map: "idx_appointments_lead_id")
  @@index([listing_id], map: "idx_appointments_listing_id")
  @@index([organization_id, start_time], map: "idx_appointments_org_start")
  @@index([organization_id, start_time(sort: Desc)], map: "idx_appointments_org_start_time")
  @@index([organization_id, status], map: "idx_appointments_org_status")
  @@index([type], map: "idx_appointments_type")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model attachments {
  id              String        @id
  organization_id String
  entity_type     String
  entity_id       String
  file_name       String
  file_size       Int
  mime_type       String
  file_path       String
  uploaded_by_id  String
  created_at      DateTime      @default(now())
  updated_at      DateTime
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users           users         @relation(fields: [uploaded_by_id], references: [id])

  @@index([entity_type, entity_id])
  @@index([organization_id])
  @@index([entity_type, entity_id, created_at(sort: Desc)], map: "idx_attachments_entity_created")
  @@index([organization_id, created_at(sort: Desc)], map: "idx_attachments_org_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model contacts {
  id                       String         @id
  name                     String         @db.VarChar(255)
  email                    String?        @db.VarChar(255)
  phone                    String?        @db.VarChar(50)
  company                  String?        @db.VarChar(255)
  position                 String?        @db.VarChar(255)
  type                     ContactType?   @default(PROSPECT)
  status                   ContactStatus? @default(ACTIVE)
  notes                    String?
  tags                     String[]       @default([])
  custom_fields            Json?
  linkedin_url             String?        @db.VarChar(500)
  twitter_url              String?        @db.VarChar(500)
  preferred_contact_method String?        @db.VarChar(50)
  organization_id          String
  assigned_to_id           String?
  created_at               DateTime?      @default(now()) @db.Timestamp(6)
  updated_at               DateTime?      @default(now()) @db.Timestamp(6)
  last_contact_at          DateTime?      @db.Timestamp(6)
  activities               activities[]
  users                    users?         @relation(fields: [assigned_to_id], references: [id], onUpdate: NoAction)
  organizations            organizations  @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  deals                    deals[]

  @@index([assigned_to_id], map: "idx_contacts_assigned_to_id")
  @@index([created_at], map: "idx_contacts_created_at")
  @@index([organization_id, created_at(sort: Desc)], map: "idx_contacts_org_created")
  @@index([organization_id, status], map: "idx_contacts_org_status")
  @@index([organization_id, type], map: "idx_contacts_org_type")
  @@index([organization_id], map: "idx_contacts_organization_id")
  @@index([status], map: "idx_contacts_status")
  @@index([type], map: "idx_contacts_type")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model content {
  id              String        @id
  organization_id String
  title           String
  slug            String
  content_type    ContentType
  content         String
  excerpt         String?
  status          ContentStatus @default(DRAFT)
  author_id       String
  published_at    DateTime?
  seo_meta        Json?
  created_at      DateTime      @default(now())
  updated_at      DateTime
  users           users         @relation(fields: [author_id], references: [id])
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@unique([organization_id, slug])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model conversations {
  id                 String                 @id
  organization_id    String
  industry           String                 @default("strive")
  session_id         String
  user_message       String
  assistant_response String
  problem_detected   String?
  solution_presented String?
  conversation_stage String
  outcome            String?
  conversion_score   Float?
  booking_completed  Boolean                @default(false)
  response_time_ms   Int?
  user_satisfaction  Int?
  created_at         DateTime               @default(now())
  updated_at         DateTime
  embedding          Unsupported("vector")?
  organizations      organizations          @relation(fields: [organization_id], references: [id])

  @@index([created_at(sort: Desc)])
  @@index([embedding])
  @@index([industry])
  @@index([organization_id])
  @@index([session_id])
  @@index([session_id], map: "conversations_session_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model customers {
  id              String         @id
  organization_id String
  name            String
  email           String?
  phone           String?
  company         String?
  status          CustomerStatus @default(LEAD)
  source          CustomerSource @default(WEBSITE)
  tags            String[]
  custom_fields   Json?
  assigned_to     String?
  created_at      DateTime       @default(now())
  updated_at      DateTime
  appointments    appointments[]
  users           users?         @relation(fields: [assigned_to], references: [id])
  organizations   organizations  @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  projects        projects[]

  @@index([email])
  @@index([organization_id])
  @@index([status])
  @@index([organization_id, created_at(sort: Desc)], map: "idx_customers_org_created")
  @@index([organization_id, status], map: "idx_customers_org_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model deals {
  id                  String         @id
  title               String         @db.VarChar(255)
  description         String?
  value               Decimal        @db.Decimal(12, 2)
  stage               DealStage?     @default(LEAD)
  status              DealStatus?    @default(ACTIVE)
  probability         Int?           @default(50)
  expected_close_date DateTime?      @db.Timestamp(6)
  actual_close_date   DateTime?      @db.Timestamp(6)
  lost_reason         String?        @db.VarChar(500)
  notes               String?
  tags                String[]       @default([])
  custom_fields       Json?
  lead_id             String?
  contact_id          String?
  listing_id          String?
  organization_id     String
  assigned_to_id      String?
  created_at          DateTime?      @default(now()) @db.Timestamp(6)
  updated_at          DateTime?      @default(now()) @db.Timestamp(6)
  activities          activities[]
  appointments        appointments[]
  users               users?         @relation(fields: [assigned_to_id], references: [id], onUpdate: NoAction)
  contacts            contacts?      @relation(fields: [contact_id], references: [id], onUpdate: NoAction)
  leads               leads?         @relation(fields: [lead_id], references: [id], onUpdate: NoAction)
  organizations       organizations  @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  listings            listings?      @relation(fields: [listing_id], references: [id], onUpdate: NoAction, map: "fk_deals_listing_id")

  @@index([assigned_to_id], map: "idx_deals_assigned_to_id")
  @@index([created_at], map: "idx_deals_created_at")
  @@index([expected_close_date], map: "idx_deals_expected_close_date")
  @@index([organization_id, stage], map: "idx_deals_org_stage")
  @@index([organization_id, stage, status], map: "idx_deals_org_stage_status")
  @@index([organization_id], map: "idx_deals_organization_id")
  @@index([stage], map: "idx_deals_stage")
  @@index([status], map: "idx_deals_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model document_signatures {
  id                 String             @id
  status             SignatureStatus    @default(PENDING)
  signed_at          DateTime?          @db.Timestamp(6)
  signature_data     String?
  ip_address         String?
  user_agent         String?
  auth_method        String?
  decline_reason     String?
  document_id        String
  signer_id          String
  request_id         String
  documents          documents          @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  signature_requests signature_requests @relation(fields: [request_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  loop_parties       loop_parties       @relation(fields: [signer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([document_id])
  @@index([request_id])
  @@index([signer_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model document_versions {
  id             String    @id
  version_number Int
  storage_key    String
  file_size      Int
  created_at     DateTime  @default(now()) @db.Timestamp(6)
  created_by     String
  document_id    String
  users          users     @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  documents      documents @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([document_id, version_number])
  @@index([document_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model documents {
  id                  String                @id
  filename            String
  original_name       String
  mime_type           String
  file_size           Int
  storage_key         String                @unique
  version             Int                   @default(1)
  status              DocumentStatus        @default(DRAFT)
  category            String?
  created_at          DateTime              @default(now()) @db.Timestamp(6)
  updated_at          DateTime              @db.Timestamp(6)
  loop_id             String
  uploaded_by         String
  document_signatures document_signatures[]
  document_versions   document_versions[]
  transaction_loops   transaction_loops     @relation(fields: [loop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users               users                 @relation(fields: [uploaded_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([category])
  @@index([loop_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model example_conversations {
  id                 String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  industry           String                 @default("strive")
  user_input         String
  assistant_response String
  problem_type       String?
  solution_type      String?
  outcome            String?
  conversion_score   Float?
  embedding          Unsupported("vector")?
  created_at         DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?              @default(now()) @db.Timestamptz(6)

  @@index([embedding])
  @@index([industry])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model feature_flags {
  id              String             @id
  name            String             @unique
  description     String?
  is_enabled      Boolean            @default(false)
  rollout_percent Float              @default(0)
  target_tiers    SubscriptionTier[] @default([])
  target_orgs     String[]           @default([])
  target_users    String[]           @default([])
  conditions      Json?
  environment     Environment        @default(PRODUCTION)
  category        String?
  created_at      DateTime           @default(now()) @db.Timestamp(6)
  updated_at      DateTime           @default(now()) @db.Timestamp(6)
  created_by      String
  users           users              @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([environment])
  @@index([is_enabled])
  @@index([name])
}

model goal_conversions {
  id              String          @id
  goal_id         String
  session_id      String
  user_id         String?
  value           Float?
  url             String
  path            String
  timestamp       DateTime        @default(now())
  analytics_goals analytics_goals @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@index([goal_id])
  @@index([timestamp])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leads {
  id              String         @id
  name            String         @db.VarChar(255)
  email           String?        @db.VarChar(255)
  phone           String?        @db.VarChar(50)
  company         String?        @db.VarChar(255)
  source          LeadSource?    @default(WEBSITE)
  status          LeadStatus?    @default(NEW_LEAD)
  score           LeadScore?     @default(COLD)
  score_value     Int?           @default(0)
  budget          Decimal?       @db.Decimal(12, 2)
  timeline        String?        @db.VarChar(200)
  notes           String?
  tags            String[]       @default([])
  custom_fields   Json?
  organization_id String
  assigned_to_id  String?
  created_at      DateTime?      @default(now()) @db.Timestamp(6)
  updated_at      DateTime?      @default(now()) @db.Timestamp(6)
  last_contact_at DateTime?      @db.Timestamp(6)
  activities      activities[]
  appointments    appointments[]
  deals           deals[]
  users           users?         @relation(fields: [assigned_to_id], references: [id], onUpdate: NoAction)
  organizations   organizations  @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assigned_to_id], map: "idx_leads_assigned_to_id")
  @@index([created_at], map: "idx_leads_created_at")
  @@index([organization_id, created_at(sort: Desc)], map: "idx_leads_org_created")
  @@index([organization_id, score, score_value(sort: Desc)], map: "idx_leads_org_score")
  @@index([organization_id, status], map: "idx_leads_org_status")
  @@index([organization_id], map: "idx_leads_organization_id")
  @@index([score], map: "idx_leads_score")
  @@index([source], map: "idx_leads_source")
  @@index([status], map: "idx_leads_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model listings {
  id               String         @id
  title            String         @db.VarChar(255)
  description      String?
  address          String         @db.VarChar(500)
  city             String         @db.VarChar(100)
  state            String         @db.VarChar(100)
  zip_code         String         @db.VarChar(20)
  country          String?        @default("USA") @db.VarChar(100)
  property_type    PropertyType?  @default(RESIDENTIAL)
  bedrooms         Int?
  bathrooms        Decimal?       @db.Decimal(3, 1)
  square_feet      Int?
  lot_size         Decimal?       @db.Decimal(10, 2)
  year_built       Int?
  price            Decimal        @db.Decimal(12, 2)
  price_per_sqft   Decimal?       @db.Decimal(10, 2)
  status           ListingStatus? @default(ACTIVE)
  mls_number       String?        @db.VarChar(100)
  listing_date     DateTime?      @db.Timestamp(6)
  expiration_date  DateTime?      @db.Timestamp(6)
  images           String[]       @default([])
  virtual_tour_url String?        @db.VarChar(500)
  features         String[]       @default([])
  notes            String?
  tags             String[]       @default([])
  custom_fields    Json?
  organization_id  String
  assigned_to_id   String?
  created_at       DateTime?      @default(now()) @db.Timestamp(6)
  updated_at       DateTime?      @default(now()) @db.Timestamp(6)
  activities       activities[]
  appointments     appointments[]
  deals            deals[]
  users            users?         @relation(fields: [assigned_to_id], references: [id], onUpdate: NoAction)
  organizations    organizations  @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assigned_to_id], map: "idx_listings_assigned_to_id")
  @@index([city], map: "idx_listings_city")
  @@index([created_at], map: "idx_listings_created_at")
  @@index([city, state, zip_code], map: "idx_listings_location")
  @@index([organization_id, status], map: "idx_listings_org_status")
  @@index([organization_id, property_type], map: "idx_listings_org_type")
  @@index([organization_id], map: "idx_listings_organization_id")
  @@index([property_type], map: "idx_listings_property_type")
  @@index([state], map: "idx_listings_state")
  @@index([status], map: "idx_listings_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model loop_parties {
  id                  String                @id
  name                String
  email               String
  phone               String?
  role                PartyRole
  permissions         Json
  status              PartyStatus           @default(ACTIVE)
  invited_at          DateTime              @default(now()) @db.Timestamp(6)
  joined_at           DateTime?             @db.Timestamp(6)
  loop_id             String
  document_signatures document_signatures[]
  transaction_loops   transaction_loops     @relation(fields: [loop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transaction_tasks   transaction_tasks[]

  @@index([email])
  @@index([loop_id])
  @@index([role])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model notifications {
  id              String           @id
  user_id         String
  organization_id String
  type            NotificationType
  title           String
  message         String
  action_url      String?
  entity_type     String?
  entity_id       String?
  read            Boolean          @default(false)
  created_at      DateTime         @default(now())
  updated_at      DateTime
  organizations   organizations    @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users           users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([organization_id, created_at(sort: Desc)], map: "idx_notifications_org_created")
  @@index([user_id, read, created_at(sort: Desc)], map: "idx_notifications_user_read_created")
  @@index([created_at(sort: Desc)])
  @@index([organization_id])
  @@index([read])
  @@index([user_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model onboarding_sessions {
  id                       String            @id
  session_token            String            @unique
  current_step             Int               @default(1)
  total_steps              Int               @default(4)
  org_name                 String?
  org_website              String?
  org_description          String?
  selected_tier            SubscriptionTier?
  billing_cycle            BillingCycle?
  stripe_payment_intent_id String?
  payment_status           PaymentStatus     @default(PENDING)
  is_completed             Boolean           @default(false)
  completed_at             DateTime?         @db.Timestamp(6)
  expires_at               DateTime          @db.Timestamp(6)
  created_at               DateTime          @default(now()) @db.Timestamp(6)
  updated_at               DateTime          @default(now()) @db.Timestamp(6)
  user_id                  String?
  organization_id          String?
  organizations            organizations?    @relation(fields: [organization_id], references: [id], onUpdate: NoAction)
  users                    users?            @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([expires_at])
  @@index([payment_status])
  @@index([session_token])
  @@index([user_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model organization_members {
  id              String        @id
  user_id         String
  organization_id String
  role            OrgRole       @default(MEMBER)
  permissions     Json?
  joined_at       DateTime      @default(now())
  created_at      DateTime      @default(now())
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users           users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, organization_id])
  @@index([user_id, organization_id], map: "idx_org_members_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model organizations {
  id                     String                   @id
  name                   String
  slug                   String                   @unique
  description            String?
  settings               Json?
  subscription_status    SubscriptionStatus       @default(TRIAL)
  billing_email          String?
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  activities             activities[]
  activity_logs          activity_logs[]
  ai_conversations       ai_conversations[]
  appointments           appointments[]
  attachments            attachments[]
  contacts               contacts[]
  content                content[]
  conversations          conversations[]
  customers              customers[]
  deals                  deals[]
  leads                  leads[]
  listings               listings[]
  notifications          notifications[]
  onboarding_sessions    onboarding_sessions[]
  organization_members   organization_members[]
  projects               projects[]
  subscriptions          subscriptions?
  transaction_audit_logs transaction_audit_logs[]
  transaction_loops      transaction_loops[]
  usage_tracking         usage_tracking[]
  workflows              workflows[]
}

model page_views {
  id            String   @id
  source        String   @default("saas")
  session_id    String
  user_id       String?
  url           String
  path          String
  title         String?
  referrer      String?
  user_agent    String?
  ip_address    String?
  country       String?
  city          String?
  device        String?
  browser       String?
  os            String?
  utm_source    String?
  utm_medium    String?
  utm_campaign  String?
  view_duration Int?
  timestamp     DateTime @default(now())

  @@index([path])
  @@index([session_id])
  @@index([source])
  @@index([timestamp])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model platform_metrics {
  id               String   @id
  date             DateTime @unique @default(now()) @db.Timestamp(6)
  total_users      Int      @default(0)
  active_users     Int      @default(0)
  new_users        Int      @default(0)
  total_orgs       Int      @default(0)
  active_orgs      Int      @default(0)
  new_orgs         Int      @default(0)
  mrr_cents        BigInt   @default(0)
  arr_cents        BigInt   @default(0)
  churn_rate       Float    @default(0)
  free_count       Int      @default(0)
  starter_count    Int      @default(0)
  growth_count     Int      @default(0)
  elite_count      Int      @default(0)
  enterprise_count Int      @default(0)
  total_storage    BigInt   @default(0)
  api_calls        Int      @default(0)
  created_at       DateTime @default(now()) @db.Timestamp(6)

  @@index([date])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model projects {
  id                  String        @id
  organization_id     String
  customer_id         String?
  name                String
  description         String?
  status              ProjectStatus @default(PLANNING)
  priority            Priority      @default(MEDIUM)
  start_date          DateTime?
  due_date            DateTime?
  completion_date     DateTime?
  budget              Decimal?      @db.Decimal(10, 2)
  progress_percentage Int           @default(0)
  project_manager_id  String
  created_at          DateTime      @default(now())
  updated_at          DateTime
  customers           customers?    @relation(fields: [customer_id], references: [id])
  organizations       organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  users               users         @relation(fields: [project_manager_id], references: [id])
  tasks               tasks[]

  @@index([organization_id, created_at(sort: Desc)], map: "idx_projects_org_created")
  @@index([organization_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model signature_requests {
  id                  String                @id
  title               String
  message             String?
  status              SignatureStatus       @default(PENDING)
  signing_order       SigningOrder          @default(PARALLEL)
  expires_at          DateTime?             @db.Timestamp(6)
  completed_at        DateTime?             @db.Timestamp(6)
  created_at          DateTime              @default(now()) @db.Timestamp(6)
  updated_at          DateTime              @db.Timestamp(6)
  loop_id             String
  requested_by        String
  document_signatures document_signatures[]
  transaction_loops   transaction_loops     @relation(fields: [loop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users               users                 @relation(fields: [requested_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([loop_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model subscriptions {
  id                     String             @id
  organization_id        String             @unique
  stripe_subscription_id String?            @unique
  stripe_customer_id     String?
  status                 SubscriptionStatus @default(TRIAL)
  tier                   SubscriptionTier   @default(STARTER)
  current_period_start   DateTime
  current_period_end     DateTime
  cancel_at_period_end   Boolean            @default(false)
  metadata               Json?
  created_at             DateTime           @default(now())
  updated_at             DateTime
  organizations          organizations      @relation(fields: [organization_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model system_alerts {
  id              String             @id
  title           String
  message         String
  level           AlertLevel         @default(INFO)
  category        AlertCategory
  is_global       Boolean            @default(false)
  target_roles    UserRole[]         @default([])
  target_tiers    SubscriptionTier[] @default([])
  target_orgs     String[]           @default([])
  is_dismissible  Boolean            @default(true)
  auto_hide_after Int?
  starts_at       DateTime           @default(now()) @db.Timestamp(6)
  ends_at         DateTime?          @db.Timestamp(6)
  view_count      Int                @default(0)
  dismiss_count   Int                @default(0)
  is_active       Boolean            @default(true)
  is_archived     Boolean            @default(false)
  created_at      DateTime           @default(now()) @db.Timestamp(6)
  updated_at      DateTime           @default(now()) @db.Timestamp(6)
  created_by      String
  users           users              @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([category])
  @@index([is_active])
  @@index([starts_at, ends_at])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tasks {
  id                             String     @id
  project_id                     String
  parent_task_id                 String?
  title                          String
  description                    String?
  status                         TaskStatus @default(TODO)
  priority                       Priority   @default(MEDIUM)
  assigned_to                    String?
  created_by                     String
  due_date                       DateTime?
  estimated_hours                Decimal?   @db.Decimal(5, 2)
  actual_hours                   Decimal?   @db.Decimal(5, 2)
  tags                           String[]
  position                       Int
  created_at                     DateTime   @default(now())
  updated_at                     DateTime
  users_tasks_assigned_toTousers users?     @relation("tasks_assigned_toTousers", fields: [assigned_to], references: [id])
  users_tasks_created_byTousers  users      @relation("tasks_created_byTousers", fields: [created_by], references: [id])
  tasks                          tasks?     @relation("tasksTotasks", fields: [parent_task_id], references: [id])
  other_tasks                    tasks[]    @relation("tasksTotasks")
  projects                       projects   @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id, status], map: "idx_tasks_project_status")
  @@index([assigned_to])
  @@index([project_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transaction_audit_logs {
  id              String        @id
  action          String
  entity_type     String
  entity_id       String
  old_values      Json?
  new_values      Json?
  ip_address      String?
  user_agent      String?
  timestamp       DateTime      @default(now()) @db.Timestamp(6)
  user_id         String
  organization_id String
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           users         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([entity_type, entity_id])
  @@index([organization_id])
  @@index([timestamp])
  @@index([user_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transaction_loops {
  id                 String               @id
  property_address   String
  transaction_type   TransactionType
  listing_price      Decimal              @db.Decimal(12, 2)
  status             LoopStatus           @default(DRAFT)
  expected_closing   DateTime?            @db.Timestamp(6)
  actual_closing     DateTime?            @db.Timestamp(6)
  progress           Int                  @default(0)
  created_at         DateTime             @default(now()) @db.Timestamp(6)
  updated_at         DateTime             @db.Timestamp(6)
  organization_id    String
  created_by         String
  documents          documents[]
  loop_parties       loop_parties[]
  signature_requests signature_requests[]
  users              users                @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  organizations      organizations        @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transaction_tasks  transaction_tasks[]
  workflows          workflows[]

  @@index([created_by])
  @@index([organization_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transaction_tasks {
  id                String            @id
  title             String
  description       String?
  status            TaskStatus        @default(TODO)
  priority          TaskPriority      @default(MEDIUM)
  due_date          DateTime?         @db.Timestamp(6)
  completed_at      DateTime?         @db.Timestamp(6)
  created_at        DateTime          @default(now()) @db.Timestamp(6)
  updated_at        DateTime          @db.Timestamp(6)
  loop_id           String
  assigned_to       String?
  created_by        String
  loop_parties      loop_parties?     @relation(fields: [assigned_to], references: [id], onUpdate: NoAction)
  users             users             @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_loops transaction_loops @relation(fields: [loop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assigned_to])
  @@index([due_date])
  @@index([loop_id])
  @@index([status])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model usage_tracking {
  id              String        @id
  organization_id String
  user_id         String
  resource_type   ResourceType
  resource_name   String
  usage_amount    Int
  billing_period  DateTime
  metadata        Json?
  created_at      DateTime      @default(now())
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@index([organization_id, billing_period, resource_type], map: "idx_usage_tracking_org_period_resource")
  @@index([organization_id, billing_period])
}

model user_sessions {
  id         String    @id
  source     String    @default("saas")
  session_id String    @unique
  user_id    String?
  start_time DateTime  @default(now())
  end_time   DateTime?
  duration   Int?
  page_views Int       @default(0)
  bounced    Boolean   @default(false)
  converted  Boolean   @default(false)
  user_agent String?
  ip_address String?
  country    String?
  city       String?
  device     String?
  browser    String?
  os         String?
  referrer   String?
  entry_page String?
  exit_page  String?

  @@index([source])
  @@index([start_time])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id                             String                   @id
  clerk_user_id                  String?                  @unique
  email                          String                   @unique
  name                           String?
  avatar_url                     String?
  role                           UserRole                 @default(EMPLOYEE)
  subscription_tier              SubscriptionTier         @default(STARTER)
  is_active                      Boolean                  @default(true)
  created_at                     DateTime                 @default(now())
  updated_at                     DateTime
  activities                     activities[]
  activity_logs                  activity_logs[]
  admin_action_logs              admin_action_logs[]
  ai_conversations               ai_conversations[]
  appointments                   appointments[]
  attachments                    attachments[]
  contacts                       contacts[]
  content                        content[]
  customers                      customers[]
  deals                          deals[]
  document_versions              document_versions[]
  documents                      documents[]
  feature_flags                  feature_flags[]
  leads                          leads[]
  listings                       listings[]
  notifications                  notifications[]
  onboarding_sessions            onboarding_sessions[]
  organization_members           organization_members[]
  projects                       projects[]
  signature_requests             signature_requests[]
  system_alerts                  system_alerts[]
  tasks_tasks_assigned_toTousers tasks[]                  @relation("tasks_assigned_toTousers")
  tasks_tasks_created_byTousers  tasks[]                  @relation("tasks_created_byTousers")
  transaction_audit_logs         transaction_audit_logs[]
  transaction_loops              transaction_loops[]
  transaction_tasks              transaction_tasks[]
  workflows                      workflows[]
}

model web_vitals_metrics {
  id              String   @id
  source          String   @default("saas")
  session_id      String
  user_id         String?
  url             String
  path            String
  metric_name     String
  metric_value    Float
  metric_rating   String
  metric_id       String
  user_agent      String?
  device          String?
  browser         String?
  connection_type String?
  timestamp       DateTime @default(now())

  @@index([metric_name])
  @@index([source])
  @@index([timestamp])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model workflows {
  id                String             @id
  name              String
  description       String?
  is_template       Boolean            @default(false)
  steps             Json
  status            WorkflowStatus     @default(ACTIVE)
  created_at        DateTime           @default(now()) @db.Timestamp(6)
  updated_at        DateTime           @db.Timestamp(6)
  loop_id           String?
  created_by        String
  organization_id   String?
  users             users              @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_loops transaction_loops? @relation(fields: [loop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  organizations     organizations?     @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_template])
  @@index([loop_id])
  @@index([organization_id])
}

enum SubscriptionTier {
  STARTER
  GROWTH
  ELITE
  ENTERPRISE
  FREE
  CUSTOM
}

enum OrgRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum LeadSource {
  WEBSITE
  REFERRAL
  GOOGLE_ADS
  SOCIAL_MEDIA
  COLD_CALL
  EMAIL_CAMPAIGN
  EVENT
  PARTNER
  OTHER
}

enum LeadStatus {
  NEW_LEAD
  IN_CONTACT
  QUALIFIED
  UNQUALIFIED
  CONVERTED
  LOST
}

enum LeadScore {
  HOT
  WARM
  COLD
}

enum DealStage {
  LEAD
  QUALIFIED
  PROPOSAL
  NEGOTIATION
  CLOSING
  CLOSED_WON
  CLOSED_LOST
}

enum LoopStatus {
  DRAFT
  ACTIVE
  UNDER_CONTRACT
  CLOSING
  CLOSED
  CANCELLED
  ARCHIVED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum PartyRole {
  BUYER
  SELLER
  BUYER_AGENT
  LISTING_AGENT
  LENDER
  TITLE_COMPANY
  INSPECTOR
  APPRAISER
  ATTORNEY
  ESCROW_OFFICER
  OTHER
}

enum SignatureStatus {
  PENDING
  SENT
  VIEWED
  SIGNED
  DECLINED
  EXPIRED
}

enum PropertyType {
  RESIDENTIAL
  COMMERCIAL
  LAND
  MULTI_FAMILY
  CONDO
  TOWNHOUSE
  LUXURY
}

enum ListingStatus {
  ACTIVE
  PENDING
  SOLD
  EXPIRED
  WITHDRAWN
  CONTINGENT
}

enum ToolCategory {
  FOUNDATION
  GROWTH
  ELITE
  CUSTOM
  ADVANCED
  INTEGRATION
}

enum ToolTier {
  T1
  T2
  T3
}

enum BundleType {
  STARTER_PACK
  GROWTH_PACK
  ELITE_PACK
  CUSTOM_PACK
}

enum PurchaseStatus {
  ACTIVE
  CANCELLED
  REFUNDED
  EXPIRED
}

enum ContentType {
  PAGE
  BLOG_POST
  DOCUMENTATION
  TEMPLATE
  ARTICLE
  LANDING_PAGE
  EMAIL_TEMPLATE
  SOCIAL_POST
  PRESS_RELEASE
  NEWSLETTER
  CASE_STUDY
  WHITEPAPER
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  REVIEW
  APPROVED
  SCHEDULED
}

enum CampaignType {
  CONTENT_MARKETING
  EMAIL_MARKETING
  SOCIAL_MEDIA
  PAID_ADVERTISING
  SEO_CAMPAIGN
  LEAD_GENERATION
  BRAND_AWARENESS
  PRODUCT_LAUNCH
}

enum CampaignStatus {
  DRAFT
  PLANNING
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum ReportType {
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM
  TAX_SUMMARY
}

enum AlertType {
  PRICE_DROP
  PRICE_INCREASE
  NEW_LISTING
  SOLD
  INVENTORY_CHANGE
  MARKET_TREND
  DEMOGRAPHIC_CHANGE
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ActionType {
  NAVIGATION
  API_CALL
  MODAL_FORM
  EXTERNAL_LINK
  WORKFLOW_TRIGGER
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum ActivityType {
  CALL
  EMAIL
  MEETING
  TASK
  NOTE
  SHOWING
  OPEN_HOUSE
  FOLLOW_UP
}

enum AIContextType {
  GENERAL
  PROJECT
  CUSTOMER
  TASK
}

enum AIModel {
  OPENAI_GPT4
  CLAUDE_SONNET
  GEMINI
  GROK
  KIMIK2
}

enum AdminAction {
  USER_CREATE
  USER_UPDATE
  USER_SUSPEND
  USER_DELETE
  USER_IMPERSONATE
  ORG_CREATE
  ORG_UPDATE
  ORG_SUSPEND
  ORG_DELETE
  SUBSCRIPTION_CREATE
  SUBSCRIPTION_UPDATE
  SUBSCRIPTION_CANCEL
  FEATURE_FLAG_UPDATE
  SYSTEM_CONFIG_UPDATE
  DATA_EXPORT
  BULK_ACTION
}

enum AlertCategory {
  SYSTEM
  MAINTENANCE
  FEATURE
  SECURITY
  BILLING
  MARKETING
}

enum AlertFrequency {
  IMMEDIATE
  DAILY
  WEEKLY
  MONTHLY
}

enum AlertLevel {
  INFO
  WARNING
  ERROR
  SUCCESS
}

enum AppointmentType {
  MEETING
  CALL
  SHOWING
  OPEN_HOUSE
  FOLLOW_UP
  OTHER
}

enum AreaType {
  ZIP
  SCHOOL_DISTRICT
  NEIGHBORHOOD
  COUNTY
  MSA
}

enum BillingCycle {
  MONTHLY
  YEARLY
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM
}

enum ContactStatus {
  ACTIVE
  INACTIVE
  DO_NOT_CONTACT
}

enum ContactType {
  PROSPECT
  CLIENT
  PAST_CLIENT
  PARTNER
  VENDOR
}

enum CustomerSource {
  WEBSITE
  REFERRAL
  SOCIAL
  EMAIL
  OTHER
}

enum CustomerStatus {
  LEAD
  PROSPECT
  ACTIVE
  CHURNED
}

enum DashboardActivitySeverity {
  INFO
  SUCCESS
  WARNING
  ERROR
  CRITICAL
}

enum DashboardActivityType {
  USER_ACTION
  SYSTEM_EVENT
  WORKFLOW_UPDATE
  DATA_CHANGE
  SECURITY_EVENT
  INTEGRATION_EVENT
}

enum DashboardTheme {
  LIGHT
  DARK
  AUTO
}

enum DealStatus {
  ACTIVE
  WON
  LOST
  ABANDONED
}

enum DocumentStatus {
  DRAFT
  PENDING
  REVIEWED
  SIGNED
  ARCHIVED
}

enum EmailStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED
}

enum Environment {
  DEVELOPMENT
  STAGING
  PRODUCTION
}

enum ExpenseCategory {
  COMMISSION
  TRAVEL
  MARKETING
  OFFICE
  UTILITIES
  LEGAL
  INSURANCE
  REPAIRS
  MEALS
  EDUCATION
  SOFTWARE
  OTHER
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  NEEDS_REVIEW
}

enum Industry {
  REAL_ESTATE
  HEALTHCARE
  STRIVE
  GENERAL
}

enum LayoutDensity {
  COMPACT
  NORMAL
  SPACIOUS
}

enum MetricCategory {
  FINANCIAL
  OPERATIONAL
  MARKETING
  SALES
  PRODUCTIVITY
  SYSTEM
  CUSTOM
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum PartyStatus {
  ACTIVE
  INACTIVE
  REMOVED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELLED
  REQUIRES_ACTION
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  FAILED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum ReidReportType {
  NEIGHBORHOOD_ANALYSIS
  MARKET_OVERVIEW
  COMPARATIVE_STUDY
  INVESTMENT_ANALYSIS
  DEMOGRAPHIC_REPORT
  CUSTOM
}

enum ResourceType {
  AI_TOKENS
  API_CALLS
  STORAGE
  SEATS
}

enum SigningOrder {
  SEQUENTIAL
  PARALLEL
}

enum SocialPlatform {
  FACEBOOK
  TWITTER
  INSTAGRAM
  LINKEDIN
  YOUTUBE
  TIKTOK
  PINTEREST
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  TRIAL
  PAST_DUE
  CANCELLED
}

enum ToolType {
  CHATBOT
  ANALYSIS
  AUTOMATION
  INTEGRATION
}

enum TransactionType {
  PURCHASE_AGREEMENT
  LISTING_AGREEMENT
  LEASE_AGREEMENT
  COMMERCIAL_PURCHASE
  COMMERCIAL_LEASE
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum UserRole {
  SUPER_ADMIN
  ADMIN
  MODERATOR
  EMPLOYEE
}

enum WidgetType {
  KPI_CARD
  CHART
  TABLE
  ACTIVITY_FEED
  QUICK_ACTIONS
  MODULE_SHORTCUTS
  PROGRESS_TRACKER
  NOTIFICATION_PANEL
  CALENDAR
  WEATHER
}

enum WorkflowStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}
